<!DOCTYPE html>
<html lang="en" ng-app="new_app">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.min.js"></script>
    <script>
        var new_app = angular.module('new_app', ['ngRoute']);
        //setting up routing
            new_app.config(function($routeProvider){
                $routeProvider
                    .when('/index', {
                        templateUrl: 'partials/index.html'
                    })
                    .when('/', {
                        templateUrl: 'partials/index.html'
                    })
                    .when('/dashboard', {
                        templateUrl: 'partials/dashboard.html'
                    })
                    .when('/user/:id', {
                        templateUrl: 'partials/user.html'
                    })
                    .otherwise({
                        redirectTo: '/'
                    });
            });
        
        new_app.factory('UserFactory', function($http){
        	var factory = {};
        	// init another array or object here
            var users = [];

        	factory.getUsers = function(callback){
        		$http.get('/users').success(function(output){
        			users = output;
        			callback(users);
        		});
        	}

            factory.addUser = function(user, callback){
                $http.post('/new_user', user).success(function(data){
                    callback(data);
                });
            }

        	return factory;
    	});

        new_app.factory('ListFactory', function($http){
            var factory = {};
            var lists = [];

            factory.getUserList = function(id, callback){
                $http.get('/user_list', id).success(function(data){
                    callback(data);
                });
            }

            factory.addUserBucket = function(bucket, callback){
                $http.post('/new_bucket', bucket).success(function(data){
                    callback(data);
                });
            }

            return factory;
        });

    	new_app.controller('UserController', function($scope, UserFactory, $rootScope, $location){
    		
            UserFactory.getUsers(function(data){
    			$scope.users = data;
    		});

            $scope.addUser = function(){
                // console.log('getting to function');
                // console.log($scope.new_user);
                UserFactory.addUser($scope.new_user, function(res){
                    // console.log('getting to controller');
                    $rootScope.user = res;
                    $location.url('/dashboard');
                    console.log('should be just one user',$rootScope.user);
                });
            }
    	});

        new_app.controller('ListController', function($scope, ListFactory, $rootScope){
            $scope.list = {};
            ListFactory.getUserList($rootScope.user, function(data){
                $scope.list = data;
            });

            $scope.newNote = function(){
                $scope.newer_note = {title: $scope.new_note.title, description: $scope.new_note.desc, tagged: $scope.new_note.tagged, user: $rootScope.user.name, user_id: $rootScope.user._id};
                console.log($scope.newer_note);
                ListFactory.addUserBucket($scope.newer_note, function(res){
                    $scope.userBuckets = res;
                    console.log('just added a new bucket', res);
                });
            }
        });
    </script>
</head>
<body>
	<div id="mainDiv" ng-view=""></div>
</body>
</html>